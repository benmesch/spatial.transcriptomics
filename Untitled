
# Using T-SNE to cluster locations
```{r}
library(Rtsne)
#st_mat <- as.matrix(st[,-1])
test2 <- Rtsne(st,dim=3)
#sample_names <- st[,1]
#test <- normalize_input(st_mat)
#dim(test)
#head(test[1:5,1:5])
#dim(st)
#head(st)
```

Cluster 2 dimensional results from T-SNE, using k-means(7)
```{r}
set.seed(1989)
clusters <- kmeans(test2$Y,7)$cluster
plot(test2$Y,col=clusters,asp=1)
```

# Overlay original tissue slide
Load stained image of breast cancer layer 1 (source: https://www.spatialresearch.org/resources-published-datasets/)
```{r}
library(magick)
full_img <- image_read('README_files/screenshots/HE_layer1_BC.jpg')
image_info(full_img)
```

Preview image:
```{r}
plot(image_scale(full_img, "1000"))
```


```{r}
overlay <- image_scale(full_img, "1000")
for (i in seq(1,length(x))) {
  xi <- x[i] * 288.9 * (1000/9245) #upscale to 9k x 9k, then downscale to 1k x 1k
  yi <- y[i] * 292.6 * (1076/9949)
  locationi <- paste("+",as.character(xi),"+",as.character(yi),sep="")
  overlay <- image_annotate(overlay, "â€¢", size = 150, gravity = "southwest", color = "red", location=locationi)
}
plot(overlay)
```

